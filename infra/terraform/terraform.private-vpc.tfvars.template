# ===========================================================================
# AI PR Reviewer — Private VPC Deployment (Pre-filled Template)
# ===========================================================================
# Copy this file to terraform.tfvars and fill in ONLY the <PLACEHOLDER> values.
# Lines starting with # are optional — uncomment and set if you need them.
#
# This template is pre-configured for:
#   ✓ Private-only VPC deployment (no public IPs)
#   ✓ Internal NLB with TLS (optional, uncomment to enable)
#   ✓ GovCloud us-gov-west-1
#   ✓ dry_run = true (safe first deploy)
# ===========================================================================

# ── Region & naming ──────────────────────────────────────────────────────
# aws_region         = "us-gov-west-1"  # Uncomment to override default
project_name       = "ai-pr-reviewer"
environment        = "<ENV>"              # prod, nonprod, dev
log_retention_days = 14

# ── GitHub ───────────────────────────────────────────────────────────────
github_api_base = "<GITHUB_API_URL>"      # https://api.github.com or https://<GHE>/api/v3
github_allowed_repos = [
  # "my-org/my-repo"                     # leave empty to allow all installed repos
]

# Existing Secrets Manager ARNs only (no Terraform secret creation)
create_secrets_manager_secrets = false
existing_github_webhook_secret_arn         = "<GITHUB_WEBHOOK_SECRET_ARN>"
existing_github_app_private_key_secret_arn = "<GITHUB_APP_PRIVATE_KEY_SECRET_ARN>"
existing_github_app_ids_secret_arn         = "<GITHUB_APP_IDS_SECRET_ARN>"
existing_atlassian_credentials_secret_arn  = "<ATLASSIAN_CREDENTIALS_SECRET_ARN>"
existing_chatbot_api_token_secret_arn      = "" # set if chatbot_auth_mode="token"
existing_teams_adapter_token_secret_arn    = "" # set if teams_adapter_enabled=true

chatbot_auth_mode         = "github_oauth"
github_oauth_allowed_orgs = ["<YOUR_ORG>"]

# Default UI prefill for GitHub OAuth login experience
webapp_default_auth_mode             = "bearer"
webapp_default_github_oauth_base_url = "<GITHUB_OAUTH_BASE_URL>" # e.g. https://github.company.mil
webapp_default_github_client_id      = "<GITHUB_OAUTH_CLIENT_ID>"
webapp_default_github_scope          = "read:user read:org"

# ── Bedrock AI ───────────────────────────────────────────────────────────
bedrock_agent_id       = ""               # Optional: Bedrock Agent ID
bedrock_agent_alias_id = ""               # Optional: Bedrock Agent Alias
bedrock_model_id       = "anthropic.claude-3-5-sonnet-20240620-v1:0"  # GovCloud FedRAMP/IL4/5 authorized
bedrock_guardrail_id      = ""            # Optional: global Bedrock guardrail ID
bedrock_guardrail_version = ""            # Guardrail version (number or DRAFT)
bedrock_guardrail_trace   = "DISABLED"    # ENABLED | DISABLED | ENABLED_FULL

# ── Safety ───────────────────────────────────────────────────────────────
dry_run = true                            # KEEP TRUE for first deploy

# ── Auto-PR (remediation PRs) ───────────────────────────────────────────
auto_pr_enabled       = false
auto_pr_max_files     = 5
auto_pr_branch_prefix = "ai-autofix"
review_comment_mode   = "inline_best_effort"
check_run_name        = "AI PR Reviewer"

# ── PR review tuning knobs ───────────────────────────────────────────────
# P1-B: Incremental review
incremental_review_enabled = true
# P2-A: Diff compression
max_review_files     = 30
max_diff_bytes       = 8000
large_patch_policy   = "clip"  # clip | skip
# P2-B: Ignore filters
# ignore_pr_authors         = ["dependabot[bot]"]
# ignore_pr_labels          = ["skip-review"]
num_max_findings        = 0    # 0 = unlimited
require_security_review = true
require_tests_review    = true
# P3: Structured verdict
failure_on_severity     = "high"  # high | medium | none

# ── Chatbot ──────────────────────────────────────────────────────────────
chatbot_enabled  = true
chatbot_model_id = "anthropic.claude-3-5-sonnet-20240620-v1:0"  # GovCloud FedRAMP/IL4/5 authorized
chatbot_guardrail_id      = ""            # Optional: chatbot-specific guardrail ID
chatbot_guardrail_version = ""            # Guardrail version (number or DRAFT)
chatbot_guardrail_trace   = "disabled"    # enabled | disabled
chatbot_allowed_llm_providers = ["bedrock"]
chatbot_allowed_model_ids = ["anthropic.claude-3-5-sonnet-20240620-v1:0"]  # GovCloud compatible models only
chatbot_atlassian_user_auth_enabled = false
chatbot_atlassian_session_broker_enabled = false
chatbot_atlassian_session_ttl_seconds = 3600
chatbot_quota_fail_open = false
chatbot_response_cache_enabled = true
chatbot_response_cache_table = ""
chatbot_response_cache_ttl_seconds = 1200
chatbot_response_cache_min_query_length = 12
chatbot_response_cache_max_answer_chars = 16000
chatbot_response_cache_lock_ttl_seconds = 15
chatbot_response_cache_lock_wait_ms = 150
chatbot_response_cache_lock_wait_attempts = 6
chatbot_rerank_enabled = true
chatbot_rerank_top_k_per_source = 3
chatbot_prompt_safety_enabled = true
chatbot_context_safety_block_request = false
chatbot_safety_scan_char_limit = 8000
chatbot_context_max_chars_per_source = 2500
chatbot_context_max_total_chars = 8000
chatbot_budgets_enabled = true
chatbot_budget_table = ""
chatbot_budget_soft_limit_usd = 0.25
chatbot_budget_hard_limit_usd = 0.75
chatbot_budget_ttl_days = 90
chatbot_jira_max_results = 3
chatbot_confluence_max_results = 3
chatbot_router_low_cost_bedrock_model_id = "amazon.nova-lite-v1:0"
chatbot_router_high_quality_bedrock_model_id = ""
chatbot_model_pricing_json = "{}"
worker_lambda_architecture = "arm64"
worker_lambda_memory_size = 768
chatbot_lambda_architecture = "arm64"
chatbot_lambda_memory_size = 384

# Image generation - WARNING: NOT AVAILABLE IN GOVCLOUD us-gov-west-1
# Amazon Titan, Nova Canvas, and Stability AI models are NOT in GovCloud
# GovCloud users: Keep chatbot_image_enabled = false
chatbot_image_enabled = false  # MUST be false for GovCloud
chatbot_image_user_requests_per_minute = 6
chatbot_image_conversation_requests_per_minute = 3

# ── Private Webapp (EC2, no public IP) ───────────────────────────────────
webapp_hosting_enabled = true
webapp_hosting_mode    = "ec2_eip"
webapp_private_only    = true

webapp_ec2_subnet_id     = "<PRIVATE_SUBNET_ID>"   # subnet-abc123
webapp_ec2_instance_type = "t3.small"
# webapp_ec2_security_group_id = ""               # Optional: use existing SG
# webapp_ec2_key_name    = "<KEY_PAIR_NAME>"        # Uncomment for SSH access

# Bring-Your-Own EC2: uncomment both lines to skip Terraform-managed EC2 creation.
# webapp_ec2_instance_id   = "<INSTANCE_ID>"        # i-0abc1234def567890
# webapp_ec2_iam_role_name = "<IAM_ROLE_NAME>"       # name (not ARN) of the instance's IAM role

# ── Internal NLB + TLS (uncomment all 4 lines to enable) ────────────────
# webapp_tls_enabled             = true
# webapp_tls_acm_certificate_arn = "<ACM_CERT_ARN>"
# webapp_tls_subnet_ids          = ["<SUBNET_A>", "<SUBNET_B>"]
# NOTE: with internal TLS enabled, users hit HTTPS/443 on the internal NLB.
# The NLB forwards to webapp_private_ip:80 on the EC2 backend.

# ── Observability ────────────────────────────────────────────────────────
# lambda_tracing_enabled              = true   # X-Ray (default: true)
# lambda_reserved_concurrency_worker  = 10     # Max concurrent workers (default: 10)
# lambda_reserved_concurrency_chatbot = 20     # Max concurrent chatbot (default: 20)

# ── Optional features (uncomment to enable) ──────────────────────────────
# test_gen_enabled        = true
# pr_description_enabled  = true
# release_notes_enabled   = true
# sprint_report_enabled   = true
# kb_sync_enabled         = true

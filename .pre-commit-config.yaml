repos:
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.8.0
    hooks:
      - id: ruff
        args: [--fix, --exit-non-zero-on-fix]
      - id: ruff-format

  - repo: https://github.com/antonbabenko/pre-commit-terraform
    rev: v1.96.2
    hooks:
      - id: terraform_fmt

  - repo: local
    hooks:
      - id: no-env-secrets
        name: Reject .env with real secrets
        entry: python -c "
import re, sys;
content = open('.env').read() if __import__('os').path.exists('.env') else '';
has_real = any(
    line.strip() and not line.startswith('#') and '=' in line
    and '<set-me>' not in line.split('=', 1)[1]
    and line.split('=', 1)[1].strip() not in ('', '\"\"', \"''\")
    for line in content.splitlines()
);
sys.exit(1) if has_real else sys.exit(0)
"
        language: python
        files: ^\.env$
        pass_filenames: false

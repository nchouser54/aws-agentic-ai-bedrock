<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Chatbot Console</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ü§ñ</text></svg>" />
    <link rel="stylesheet" href="styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  </head>
  <body>
    <main class="container">
      <h1>AI Chatbot Console</h1>
      <p class="subtitle">Small internal web client for <code>/chatbot/query</code>.</p>

      <section class="panel">
        <h2>Connection</h2>
        <div class="grid two">
          <label>
            Chatbot URL
            <input id="chatbotUrl" placeholder="https://.../chatbot/query" />
          </label>
          <label>
            Auth Mode
            <select id="authMode">
              <option value="token">token (X-Api-Token)</option>
              <option value="bearer">bearer (JWT / GitHub OAuth)</option>
              <option value="none">none</option>
            </select>
          </label>
          <label>
            Auth Value
            <div class="input-with-toggle">
              <input id="authValue" type="password" placeholder="token or bearer jwt" />
              <button id="authToggleBtn" type="button" class="icon-btn" title="Show/hide auth value" aria-label="Toggle auth value visibility">üëÅ</button>
            </div>
          </label>
          <label>
            Retrieval Mode
            <select id="retrievalMode">
              <option value="hybrid">hybrid</option>
              <option value="kb">kb</option>
              <option value="live">live</option>
            </select>
          </label>
          <label>
            Assistant Mode
            <select id="assistantMode">
              <option value="contextual">contextual (Jira/Confluence/KB aware)</option>
              <option value="general">general AI chat</option>
            </select>
          </label>
          <label>
            LLM Provider
            <select id="llmProvider">
              <option value="bedrock">bedrock</option>
            </select>
          </label>
          <label>
            Model ID (optional override)
            <input id="modelId" list="modelSuggestions" placeholder="amazon.nova-pro-v1:0" />
          </label>
          <label>
            Conversation ID (optional)
            <input id="conversationId" placeholder="team-standup-2026-02" />
          </label>
          <label>
            Stream-style response
            <select id="streamMode">
              <option value="true">enabled</option>
              <option value="false">disabled</option>
            </select>
          </label>
          <label>
            Image Size
            <select id="imageSize">
              <option value="">default (1024x1024)</option>
              <option value="512x512">512x512</option>
              <option value="768x768">768x768</option>
              <option value="1024x1024">1024x1024</option>
              <option value="1280x1280">1280x1280</option>
              <option value="2048x2048">2048x2048</option>
            </select>
          </label>
        </div>
        <div class="actions">
          <button id="refreshModelsBtn" type="button">Refresh GovCloud Models</button>
        </div>
        <datalist id="modelSuggestions">
          <option value="amazon.nova-lite-v1:0"></option>
          <option value="amazon.nova-pro-v1:0"></option>
          <option value="amazon.titan-text-premier-v1:0"></option>
        </datalist>
        <details class="gh-login" id="ghLoginPanel">
          <summary>GitHub Login (device flow, optional)</summary>
          <p class="muted small">
            Use an enterprise hosted GitHub OAuth App client ID to sign in and auto-fill bearer auth. If your browser blocks this flow, use manual bearer token mode.
          </p>
          <div class="grid two">
            <label>
              GitHub OAuth Base URL
              <input id="githubOauthBaseUrl" placeholder="https://github.<your-enterprise-domain>" />
            </label>
            <label>
              GitHub OAuth Client ID
              <input id="githubClientId" placeholder="Iv1.0123456789abcdef" />
            </label>
            <label>
              GitHub Scope
              <input id="githubScope" value="read:user read:org" />
            </label>
          </div>
          <div class="actions">
            <button id="githubLoginBtn" type="button">Login with GitHub</button>
          </div>
          <div id="githubLoginStatus" class="status muted">Not started.</div>
        </details>
        <details class="gh-login" id="atlassianPanel">
          <summary>Atlassian Session (optional, user-level Jira/Confluence auth)</summary>
          <p class="muted small">
            Provide your own Atlassian credentials to query Jira/Confluence as yourself instead of the service account.
            Creates a server-side session so credentials are not sent on every request.
          </p>
          <div class="grid two">
            <label>
              Atlassian Email
              <input id="atlassianEmail" type="email" placeholder="you@company.com" />
            </label>
            <label>
              Atlassian API Token
              <div class="input-with-toggle">
                <input id="atlassianApiToken" type="password" placeholder="API token from id.atlassian.com" />
                <button id="atlassianTokenToggleBtn" type="button" class="icon-btn" title="Show/hide token" aria-label="Toggle token visibility">üëÅ</button>
              </div>
            </label>
          </div>
          <div class="actions">
            <button id="atlassianLoginBtn" type="button">Create Session</button>
            <button id="atlassianLogoutBtn" type="button">Clear Session</button>
          </div>
          <div id="atlassianStatus" class="status muted">No session.</div>
        </details>
        <details class="gh-login" id="memoryPanel">
          <summary>Conversation Memory</summary>
          <p class="muted small">
            Clear stored conversation history. "Clear This" clears the current conversation ID; "Clear All" clears all your conversations.
          </p>
          <div class="actions">
            <button id="memoryClearBtn" type="button">Clear This Conversation</button>
            <button id="memoryClearAllBtn" type="button">Clear All Memory</button>
          </div>
          <div id="memoryStatus" class="status muted">No action taken.</div>
        </details>
      </section>

      <section class="panel">
        <h2>Prompt</h2>
        <div class="grid one">
          <label>
            Query <span class="muted small kbd-hint" id="kbdHint"></span>
            <textarea id="query" rows="6" placeholder="Ask about Jira, Confluence, or indexed GitHub docs..."></textarea>
          </label>
          <div class="grid two">
            <label>
              Jira JQL (optional)
              <input id="jiraJql" placeholder="project=PLAT order by updated DESC" />
            </label>
            <label>
              Confluence CQL (optional)
              <input id="confluenceCql" placeholder="type=page order by lastmodified desc" />
            </label>
          </div>
        </div>
        <div class="actions">
          <button id="saveBtn" type="button">Save Settings</button>
          <button id="sendBtn" type="button" class="btn-primary">Ask Chatbot</button>
          <button id="imageBtn" type="button">Generate Image</button>
        </div>
      </section>

      <section class="panel">
        <h2>Response</h2>
        <div id="status" class="status muted">Ready.</div>
        <div class="response-toolbar">
          <button id="copyBtn" type="button" class="icon-btn" title="Copy response to clipboard" aria-label="Copy response" hidden>üìã Copy</button>
          <button id="downloadImgBtn" type="button" class="icon-btn" title="Download generated image" aria-label="Download image" hidden>‚¨á Download</button>
          <button id="clearBtn" type="button" class="icon-btn" title="Clear response" aria-label="Clear response">‚úï Clear</button>
        </div>
        <div id="answer" class="answer">No response yet.</div>
        <div id="feedbackBar" class="feedback-bar" hidden>
          <span class="feedback-label">Was this helpful?</span>
          <button id="thumbsUpBtn" type="button" class="feedback-btn" title="Thumbs up" aria-label="Positive feedback">üëç</button>
          <button id="thumbsDownBtn" type="button" class="feedback-btn" title="Thumbs down" aria-label="Negative feedback">üëé</button>
        </div>
        <div id="citations" class="citations" hidden></div>
        <div id="sources" class="sources"></div>
        <div id="imageWrap" class="image-wrap" hidden>
          <img id="imagePreview" alt="Generated image preview" />
        </div>
      </section>
    </main>

    <script>
      var isMac = (navigator.userAgentData && navigator.userAgentData.platform === "macOS") ||
        /Mac/i.test(navigator.platform || "");
      document.getElementById("kbdHint").textContent =
        isMac ? "(‚åò+Enter to send)" : "(Ctrl+Enter to send)";
    </script>
    <script src="config.js"></script>
    <script src="app.js"></script>
  </body>
</html>
